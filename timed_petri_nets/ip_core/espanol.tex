%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%																					%
%	TRABAJO: Paper Redes de Petri Temporizadas										%
%																					%
%		Titulo: 	Ejecucion de Redes de Petri Temporizadas						%
%																					%
%		Autores:	Julian Nonino													%
%					Carlos Renzo Pisetta											%
%					Orlando Micolini												%
%																					%
%	Seccion: IP core																%	
%	Archivo: ip_core.tex															%
%																					%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%	REVISIONES																		%
%																					%
%		19/10/2012																	%
%			Julian Nonino															%
%				Creacion de este archivo											%
%																					%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{IP cores}

		La arquitectura de este IP core se mantiene en su mayor parte igual a la de las versiones anteriores. 
		Con respecto a la versión que procesa \emph{Redes de Petri con Tiempo}, se quitaron los vectores \emph{EFT} 
		y \emph{LFT}, en su lugar se agregó el \textbf{\emph{vector duración}}. Se mantuvo el \textbf{\emph{vector de 
		incrementos de tiempo}} y el \textbf{\emph{vector de tiempo de sensibilización}}.
		 
		\subsection{Estructuras de datos para Redes de Petri Temporizadas}
	
		Como se muestra en la figura \ref{fig:diseno48} las estructuras de datos necesarias para la resolución 
		de Redes de Petri Temporizadas son tres:
		\begin{itemize}
		  	\item Vector \textbf{\emph{duración}}.
		  	\item Vector de \textbf{\emph{marcas temporales}}.
		  	\item Vector de \textbf{\emph{escala de incrementos de tiempo}}.
		\end{itemize}
		
		\begin{figure*}[!b]
			\centering
			\includegraphics[width=6.5in]{diseno48}
			\caption{Arquitectura del procesador de Redes de Petri Temporizadas}
			\label{fig:diseno48}
		\end{figure*}
		
		Los cuatro vectores tienen como cantidad de elementos el número de transiciones. Los dos primeros son 
		tiene un tamaño de elementos parametrizable pero por defecto tienen 32 bits. El vector de escala de 
		incrementos de tiempo, por defecto toma el un tamaño de elementos de 5 bits.

		\subsection{Algoritmo de Ejecución con Redes de Petri Temporizada}
	Basados en la teoria descripta se creo un algoritmo de ejecución de disparos en una red de petri que se describe a continuación es sintetizable en hardware y requiere 
	únicamente 2 ciclos de reloj para ejecutar todos los pasos y a la vez permita un diseño parametrizable en cuanto al tamaño y cantidad de elementos que soporte.

	\begin{enumerate}
		\item Espera de disparo en Cola de entrada de disparos.
		\item Llegado el disparo se calcula un vector binario de longitud cantidad de transiciones con un único 1 en el lugar correspondiente al número de disparo, en función del número de transición que contenga. Este vector se utiliza para incrementar los contadores de disparos.
			Son considerados disparos en espera.
		\item Se calcula todos los posibles resultados para todos los disparos, hayan sido pedidos o no para confeccionar una matriz resultado donde cada columna Ci representa el nuevo marcado si la transición Ti  se disparara.
		\item Se crea una matriz de signos auxiliar con los signos correspondientes a cada elemento de la matriz resultado. 
		\item Se crea una matriz de inhibición auxiliar en función del marcado actual y la Matriz de Inhibición determinando las plazas con arcos inhibidores que tienen tokens.
		\item Se crea una matriz de cotas en función de la matriz resultados y las cotas de las plazas determinando cual fue superada para cada plaza por cada posible resultado
		\item Se crea un vector en el cual cada elemento corresponde a una columna de la matriz de signos y determina si esa transición es o no posible en función si algún elemento de su resultado es negativo.
		\item Se crea un vector en el cual cada elemento corresponde a una columna de la matriz de inhibición y determina las transiciones que no pueden ser disparada debido a arcos inhibidores.
		\item Se crea un vector en el cual cada elemento corresponde a una columna de la matriz de cotas el cual determina que transiciones no pueden ser disparadas debido a que provocarían superar las cotas de las plazas.
		\item En función de los vectores creados en los puntos 7, 8 y 9 se crea un vector que determina las transiciones sensibilizadas. 
		\item Para determinar las transiciones a disparar se unen los disparos pendientes y las transiciones automáticas. Luego en función de los disparos posibles y que la cola de disparos de salida no esté llena se actualiza el marcado únicamente retirando tokens de las plazas  de entrada en función de la matriz I-.
		\item Se habilita contador de transición temporizada.
		\item En cada clock de reloj se actualiza el vector de tiempo (contador saturado) de cada transición sensibilizada incrementándolo según el vector de incremento de tiempo correspondiente a partir de que la transición es disparada.
		\item Cuando el vector de tiempo supera la duración de la transición se completa el disparo actualizando el marcado únicamente agregando los tokens en las plazas de salida en función de la matriz I+.
		\item Se incrementa contador de cola de salida correspondiente a transición ejecutada.
	\end{enumerate}	

	\section{Crecimiento del IP Core}
	Se analizó el crecimiento del procesador en función de los parámetros que posee. 
	Para esto se generaron procesadores de 8x8, 16x16 y 
	32x32 con capacidad de 7 bits por plaza y elementos de tiempo de 48 bits 
	y se graficaron los valores que se pueden observar en la Figura \ref{fig:resultados09}.
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=3.5in]{resultados09}
		\caption{Diferentes implementaciones del procesador de Redes de Petri}
		\label{fig:resultados09}
	\end{figure}

	Es observa que el crecimiento del IP Core no es algo para despreciar, puesto que 
	se incrementa rápidamente a medida que aumentamos la cantidad de elementos soportados.
	Se observa también que si bien la pendiente aumenta, éstos incrementos son cada vez menores,
	tendiendo a linealizar para los IP Cores más grandes.

\section{Timed vs Time}

	Debido a la posibilidad de implementar Timed Petri Nets utilizando plazas y transiciones intermedias
	utilizando un procesador de Time Petries Nets, se compararon las curvas de crecimiento, las cuales se 
	muestran en la la Figura\ref{fig:timevstimed}
	
	\begin{figure}[h]
		\centering
		\includegraphics[width=3.5in]{timevstimed} 
		\caption{Comparación del crecimiento del IP Core}
		\label{fig:timevstimed} 
	\end{figure}

	Se Puede observar que el incremento de Flip-Flops se mantienen parejos, pero en el caso de las LUTs
	el crecimiento exponencial posee mayor pendiente en el Timed ip core, necesitando un 90\% mas que el
	Time ip core. 