%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%																					%
%	TRABAJO: Paper Redes de Petri con Tiempo										%
%																					%
%		Titulo: 	Ejecucion de Redes de Petri con Tiempo							%
%																					%
%		Autores:	Julian Nonino													%
%					Carlos Renzo Pisetta											%
%					Orlando Micolini												%
%																					%
%	Seccion: IP core																%	
%	Archivo: ip_core.tex															%
%																					%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%	REVISIONES																		%
%																					%
%		19/10/2012																	%
%			Julian Nonino															%
%				Creacion de este archivo											%
%		04/04/2013																	%
%			Renzo Pisetta															%
%				Modifica															%
%																					%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{IP cores}

			La arquitectura del procesador de Redes de Petri ya existente se expande para soportar las nuevas sintaxis,se 
		agregan estructuras de datos necesarias.
		
\begin{figure}[h]
			\centering
			\includegraphics[width=3in]{./img/diseno33}
			\caption{Arquitectura del Procesador de Redes de Petri con Tiempo}
			\label{fig:diseno33}
\end{figure}
	\begin{itemize}
		  	\item Vector \textbf{\emph{Earlier Firing Time (EFT)}}.
		  	\item Vector de \textbf{\emph{marcas temporales}}.
		  	\item Vector \textbf{\emph{Latest Firing Time (LFT)}}.
		  	\item Vector de \textbf{\emph{escala de incrementos de tiempo}}.
		\end{itemize}
		Los cuatro vectores tienen como cantidad de elementos el número de transiciones. Los 
		tres primeros tienen un tamaño de elementos parametrizable pero por defecto tienen 
		48 bits. El vector de escala de incrementos de tiempo, por defecto toma el un tamaño 
		de elementos de 5 bits.

\subsection{Algoritmo de Ejecución con Redes de Petri con Tiempo}
	Basados en la teoria descripta se creo un algoritmo de ejecución de disparos en una red de petri que se describe a continuación es sintetizable en hardware y requiere 
	únicamente 2 ciclos de reloj para ejecutar todos los pasos y a la vez permita un diseño parametrizable en cuanto al tamaño y cantidad de elementos que soporte.
	
	\begin{enumerate}
	\item Espera de disparo en Cola de entrada de disparos.
	\item Llegado el disparo se calcula un vector binario de longitud cantidad de transiciones con un único 1 en el lugar correspondiente al número de disparo, en función del número de transición que contenga. Este vector se utiliza para incrementar los contadores de disparos.
		Son considerados disparos en espera.
	\item Se calcula todos los posibles resultados para todos los disparos, hayan sido pedidos o no para confeccionar una matriz resultado donde cada columna Ci representa el nuevo marcado si la transición Ti  se disparara.
	\item Se crea una matriz de signos auxiliar con los signos correspondientes a cada elemento de la matriz resultado. 
	\item Se crea una matriz de inhibición auxiliar en función del marcado actual y la Matriz de Inhibición determinando las plazas con arcos inhibidores que tienen tokens.
	\item Se crea una matriz de cotas en función de la matriz resultados y las cotas de las plazas determinando cual fue superada para cada plaza por cada posible resultado
	\item Se crea un vector en el cual cada elemento corresponde a una columna de la matriz de signos y determina si esa transición es o no posible en función si algún elemento de su resultado es negativo.
	\item Se crea un vector en el cual cada elemento corresponde a una columna de la matriz de inhibición y determina las transiciones que no pueden ser disparada debido a arcos inhibidores.
	\item Se crea un vector en el cual cada elemento corresponde a una columna de la matriz de cotas el cual determina que transiciones no pueden ser disparadas debido a que provocarían superar las cotas de las plazas.
	\item En función de los vectores creados en los puntos 7, 8 y 9 se crea un vector que determina las transiciones sensibilizadas. 
	\item Se genera un vector en el cual cada elemento corresponde a la transición de igual índice y se verifica que vector de tiempo correspondiente se encuentre entre el EFT y LFT para determinar si la transición se puede ejecutar en función del tiempo
	\item Se genera un vector en función de lo obtenido en los puntos 10 y 11 determinando que disparos son posibles.
	\item Para determinar las transiciones a disparar se unen los disparos pendientes y las transiciones automáticas. Luego en función de los disparos posibles y que la cola de disparos de salida no esté llena se actualiza el marcado actual a partir del resultado obtenido en el punto 3 considerando la mayor prioridad al índice de mayor valor. 
	\item Se incrementa contador de cola de salida correspondiente a transición ejecutada.
	\item En cada clock de reloj se actualiza el vector de tiempo (contador saturado) de cada transición sensibilizada incrementándolo según el vector de incremento de tiempo correspondiente a partir de que la transición es sensibilizada.

\end{enumerate}	